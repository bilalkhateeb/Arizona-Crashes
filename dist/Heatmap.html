<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.2">
<title>Arizona County Crash Comparison | Arizona Crash Report</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-near-midnight.d49e655d.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-near-midnight.d49e655d.css">
<link rel="modulepreload" href="./_observablehq/client.90be1c3d.js">
<link rel="modulepreload" href="./_observablehq/runtime.f168f711.js">
<link rel="modulepreload" href="./_observablehq/stdlib.a7574edc.js">
<script type="module">

import "./_observablehq/client.90be1c3d.js";

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Arizona Crash Report</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./">Home</a></li>
    <li class="observablehq-link"><a href="./map">Map</a></li>
    <li class="observablehq-link"><a href="./Barchart">Bar chart</a></li>
    <li class="observablehq-link"><a href="./ConnectedScatter">ConnectedScatter plot</a></li>
    <li class="observablehq-link"><a href="./Ridgeline">Ridgeline</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./Heatmap">Heatmap</a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="visualization-5-crashes-by-hour-and-day-of-week" tabindex="-1"><a class="observablehq-header-anchor" href="#visualization-5-crashes-by-hour-and-day-of-week">🚗 Visualization 5: Crashes by Hour and Day of Week</a></h1>
<p>This heatmap explores the correlation between car crashes per hour and days of the week for 2023. The color intensity (in red) represents the crash count.<br>
Hover over a cell to see its crash count with projection lines to the axes.</p>
<div id="app"></div>
<!-- JavaScript Code -->
<script type="module">
  import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.16/+esm";
  import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

  (async () => {
    const app = document.getElementById("app");
    app.innerHTML = ""; // Clear previous content

    function renderHeatmap(selectedYear, csvData) {
      const chartWidth = Math.max(window.innerWidth * 0.9, 1000);
      const filteredData = csvData.filter((d) => d.Year === Number(selectedYear));

      const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
      const longData = [];
      filteredData.forEach((d) => {
        const hour = d["Hour Beginning"];
        days.forEach((day) => {
          const col = `${day} All`;
          const crashes = typeof d[col] === "number" ? d[col] : +d[col].replace(/,/g, "");
          longData.push({ hour, day, crashes, title: `Hour: ${hour}\nDay: ${day}\nCrashes: ${crashes}` });
        });
      });

      const chart = Plot.plot({
        width: chartWidth,
        height: 500,
        background: "#111",
        marginLeft: 140,
        marginBottom: 110,
        x: {
          label: "Hour of Day",
          type: "band",
          tickRotate: -60,
          domain: [...new Set(longData.map((d) => d.hour))],
          padding: 0.05,
          tickFormat: (d) => (d === "12:00 AM" ? "🌜" : d === "12:00 PM" ? "☀️" : d),
          grid: true,
          tickColor: "#888",
          labelColor: "white",
        },
        y: {
          label: "Day of Week",
          type: "band",
          domain: days,
          padding: 0.05,
          grid: true,
          tickColor: "#888",
          labelColor: "white",
        },
        color: {
          label: "Crash Count",
          scheme: "reds",
          zero: "#111",
        },
        marks: [
          Plot.cell(longData, {
            x: "hour",
            y: "day",
            fill: "crashes",
            inset: 0,
            title: (d) => d.title,
          }),
        ],
        style: {
          fontSize: "18px",
          fontFamily: "sans-serif",
          fontWeight: "bold",
        },
      });

      const chartContainer = document.getElementById("chartContainer");
      chartContainer.innerHTML = "";
      chartContainer.appendChild(chart);
    }

    // Load CSV file
    const csvData = await d3.csv("data/Crashes by Hour and Day of Week.csv", d3.autoType);
    if (!csvData || csvData.length === 0) {
      app.innerHTML = "<p style='color:red;'>No data loaded. Please check the CSV file attachment.</p>";
      return;
    }

    const uniqueYears = Array.from(new Set(csvData.map((d) => d.Year))).sort((a, b) => a - b);
    if (uniqueYears.length === 0) {
      app.innerHTML = "<p style='color:red;'>No year data found in the file.</p>";
      return;
    }

    const container = document.createElement("div");
    container.style.maxWidth = "1000px";
    container.style.margin = "0 auto";
    container.style.padding = "20px";
    container.style.background = "#111";
    container.style.borderRadius = "10px";
    container.style.boxShadow = "2px 2px 10px rgba(0,0,0,0.5)";
    container.style.textAlign = "center";

    const sliderContainer = document.createElement("div");
    sliderContainer.style.marginBottom = "20px";
    sliderContainer.innerHTML = `
      <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
        <span style="font-size: 16px; font-weight: bold; color: white;">Select Year:</span>
        <input type="range" id="yearRange" min="${uniqueYears[0]}" max="${uniqueYears[uniqueYears.length - 1]}" step="1" value="${uniqueYears[uniqueYears.length - 1]}" style="width: 200px; height: 6px; accent-color: #4c8cff; margin: 0;">
        <span id="yearDisplay" style="font-size: 16px; font-weight: bold; color: #fff;">${uniqueYears[uniqueYears.length - 1]}</span>
      </div>
    `;
    container.appendChild(sliderContainer);

    const chartContainer = document.createElement("div");
    chartContainer.id = "chartContainer";
    container.appendChild(chartContainer);
    app.appendChild(container);

    renderHeatmap(uniqueYears[uniqueYears.length - 1], csvData);

    document.getElementById("yearRange").addEventListener("input", function () {
      document.getElementById("yearDisplay").textContent = this.value;
      renderHeatmap(this.value, csvData);
    });

    window.addEventListener("resize", () => {
      renderHeatmap(document.getElementById("yearRange").value, csvData);
    });
  })();
</script>
<!-- Styles -->
<style>
#app {
  width: 100%;
  margin: 0 auto;
  background: #111;
  font-family: sans-serif;
}

.custom-legend {
  margin-top: 20px;
  margin-left: 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 300px;
}

.legend-boxes {
  display: flex;
  height: 30px;
  width: 100%;
}

.legend-box {
  flex: 1;
  height: 20px;
}

.legend-labels {
  display: flex;
  width: 100%;
  justify-content: space-between;
  font-size: 12px;
  color: white;
  margin-top: 5px;
}
</style>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./Ridgeline"><span>Ridgeline</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-02-04T17:40:55">Feb 4, 2025</a>.</div>
</footer>
</div>
</body>
</html>
